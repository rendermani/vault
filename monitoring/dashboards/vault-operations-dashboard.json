{
  "dashboard": {
    "id": null,
    "title": "Vault Operations Dashboard",
    "tags": ["vault", "hashicorp", "security"],
    "style": "dark",
    "timezone": "UTC",
    "refresh": "30s",
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "templating": {
      "list": [
        {
          "name": "vault_instance",
          "type": "query",
          "query": "label_values(vault_core_unsealed, instance)",
          "refresh": 1,
          "includeAll": false,
          "multi": false,
          "current": {
            "selected": false,
            "text": "All",
            "value": "$__all"
          }
        },
        {
          "name": "datacenter",
          "type": "query",
          "query": "label_values(vault_core_unsealed, datacenter)",
          "refresh": 1,
          "includeAll": true,
          "multi": true
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "title": "Vault Cluster Status",
        "type": "stat",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 0},
        "options": {
          "colorMode": "background",
          "graphMode": "none",
          "orientation": "horizontal",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"],
            "fields": ""
          },
          "textMode": "auto"
        },
        "fieldConfig": {
          "defaults": {
            "color": {
              "mode": "thresholds"
            },
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "green", "value": 1}
              ]
            },
            "mappings": [
              {
                "options": {
                  "0": {"text": "SEALED", "color": "red"},
                  "1": {"text": "UNSEALED", "color": "green"}
                },
                "type": "value"
              }
            ],
            "unit": "none"
          }
        },
        "targets": [
          {
            "expr": "vault_core_unsealed{instance=~\"$vault_instance\"}",
            "legendFormat": "{{instance}} - Seal Status",
            "refId": "A"
          }
        ]
      },
      {
        "id": 2,
        "title": "API Request Rate",
        "type": "stat",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 0},
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "orientation": "horizontal"
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "reqps"
          }
        },
        "targets": [
          {
            "expr": "rate(vault_barrier_list_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - List Ops/sec",
            "refId": "A"
          },
          {
            "expr": "rate(vault_barrier_get_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - Get Ops/sec",
            "refId": "B"
          },
          {
            "expr": "rate(vault_barrier_put_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - Put Ops/sec",
            "refId": "C"
          }
        ]
      },
      {
        "id": 3,
        "title": "Request Latency Distribution",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 8},
        "options": {
          "tooltip": {"mode": "multi", "sort": "none"},
          "legend": {"displayMode": "table", "placement": "right", "values": ["last", "max", "mean"]}
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "ms"
          }
        },
        "targets": [
          {
            "expr": "histogram_quantile(0.50, sum(rate(vault_barrier_get_duration_bucket{instance=~\"$vault_instance\"}[5m])) by (le, instance))",
            "legendFormat": "{{instance}} - P50 Get Latency",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.95, sum(rate(vault_barrier_get_duration_bucket{instance=~\"$vault_instance\"}[5m])) by (le, instance))",
            "legendFormat": "{{instance}} - P95 Get Latency",
            "refId": "B"
          },
          {
            "expr": "histogram_quantile(0.99, sum(rate(vault_barrier_get_duration_bucket{instance=~\"$vault_instance\"}[5m])) by (le, instance))",
            "legendFormat": "{{instance}} - P99 Get Latency",
            "refId": "C"
          }
        ]
      },
      {
        "id": 4,
        "title": "Token Operations",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "ops"
          }
        },
        "targets": [
          {
            "expr": "rate(vault_token_create_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - Token Creates/sec",
            "refId": "A"
          },
          {
            "expr": "rate(vault_token_lookup_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - Token Lookups/sec",
            "refId": "B"
          },
          {
            "expr": "rate(vault_token_revoke_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - Token Revokes/sec",
            "refId": "C"
          }
        ]
      },
      {
        "id": 5,
        "title": "Storage Backend Performance",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "ms"
          }
        },
        "targets": [
          {
            "expr": "vault_raft_leader_lastContact{instance=~\"$vault_instance\"}",
            "legendFormat": "{{instance}} - Raft Last Contact",
            "refId": "A"
          },
          {
            "expr": "histogram_quantile(0.99, sum(rate(vault_raft_commitTime_bucket{instance=~\"$vault_instance\"}[5m])) by (le, instance))",
            "legendFormat": "{{instance}} - P99 Commit Time",
            "refId": "B"
          }
        ]
      },
      {
        "id": 6,
        "title": "Authentication Methods Usage",
        "type": "piechart",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 24},
        "options": {
          "pieType": "donut",
          "tooltip": {"mode": "single"},
          "legend": {"displayMode": "table", "placement": "right"}
        },
        "targets": [
          {
            "expr": "sum(increase(vault_route_count{method=\"POST\", path=~\".*/auth/.*/login\"}[1h])) by (path)",
            "legendFormat": "{{path}}",
            "refId": "A"
          }
        ]
      },
      {
        "id": 7,
        "title": "Secrets Engine Usage",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 24},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "ops"
          }
        },
        "targets": [
          {
            "expr": "sum(rate(vault_route_count{path=~\".*/secret/.*\"}[5m])) by (path)",
            "legendFormat": "KV Secrets - {{path}}",
            "refId": "A"
          },
          {
            "expr": "sum(rate(vault_route_count{path=~\".*/database/.*\"}[5m])) by (path)",
            "legendFormat": "Database Secrets - {{path}}",
            "refId": "B"
          },
          {
            "expr": "sum(rate(vault_route_count{path=~\".*/pki/.*\"}[5m])) by (path)",
            "legendFormat": "PKI - {{path}}",
            "refId": "C"
          }
        ]
      },
      {
        "id": 8,
        "title": "Memory Usage",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 32},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "bytes"
          }
        },
        "targets": [
          {
            "expr": "vault_runtime_alloc_bytes{instance=~\"$vault_instance\"}",
            "legendFormat": "{{instance}} - Allocated Memory",
            "refId": "A"
          },
          {
            "expr": "vault_runtime_sys_bytes{instance=~\"$vault_instance\"}",
            "legendFormat": "{{instance}} - System Memory",
            "refId": "B"
          },
          {
            "expr": "vault_runtime_heap_objects{instance=~\"$vault_instance\"}",
            "legendFormat": "{{instance}} - Heap Objects",
            "refId": "C"
          }
        ]
      },
      {
        "id": 9,
        "title": "High Availability Status",
        "type": "table",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 32},
        "options": {
          "showHeader": true
        },
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "thresholds"},
            "thresholds": {
              "mode": "absolute",
              "steps": [
                {"color": "red", "value": null},
                {"color": "green", "value": 1}
              ]
            },
            "mappings": [
              {
                "options": {
                  "0": {"text": "STANDBY", "color": "orange"},
                  "1": {"text": "LEADER", "color": "green"}
                },
                "type": "value"
              }
            ]
          }
        },
        "targets": [
          {
            "expr": "vault_core_active{instance=~\"$vault_instance\"}",
            "legendFormat": "",
            "refId": "A",
            "format": "table"
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {
                "Time": true,
                "__name__": true
              },
              "indexByName": {
                "instance": 0,
                "Value": 1
              },
              "renameByName": {
                "Value": "Status",
                "instance": "Vault Instance"
              }
            }
          }
        ]
      },
      {
        "id": 10,
        "title": "Audit Log Volume",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 24, "x": 0, "y": 40},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "logs/sec"
          }
        },
        "targets": [
          {
            "expr": "rate(vault_audit_log_request_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - Audit Requests/sec",
            "refId": "A"
          },
          {
            "expr": "rate(vault_audit_log_response_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - Audit Responses/sec",
            "refId": "B"
          }
        ]
      },
      {
        "id": 11,
        "title": "Error Rates",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 0, "y": 48},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "percent"
          }
        },
        "targets": [
          {
            "expr": "rate(vault_route_count{code!~\"2..\"}[5m]) / rate(vault_route_count[5m]) * 100",
            "legendFormat": "{{instance}} - Error Rate %",
            "refId": "A"
          }
        ]
      },
      {
        "id": 12,
        "title": "Lease Management",
        "type": "timeseries",
        "gridPos": {"h": 8, "w": 12, "x": 12, "y": 48},
        "fieldConfig": {
          "defaults": {
            "color": {"mode": "palette-classic"},
            "unit": "short"
          }
        },
        "targets": [
          {
            "expr": "vault_expire_num_leases{instance=~\"$vault_instance\"}",
            "legendFormat": "{{instance}} - Active Leases",
            "refId": "A"
          },
          {
            "expr": "rate(vault_expire_lease_expiration_count{instance=~\"$vault_instance\"}[5m])",
            "legendFormat": "{{instance}} - Lease Expirations/sec",
            "refId": "B"
          }
        ]
      }
    ]
  }
}